var jstlWcUtil = typeof(exports) == 'undefined' ? {} : exports;
;(function(exports){

	var extend = function(target) {
		for(var i=1; i<arguments.length; i++) {
			var src = arguments[i];
			for(var attr in src) {
				target[attr] = src[attr];
			}
		}
		return target;
	}
	var getParams = function(request) {
		var params = extend({}, request.query||{}, request.body || {}/*, request.params||{}*/);
		for(var attr in params) {
			if( typeof(params[attr]) != 'string' ) {
				delete params[attr];
			}
		}
		return params;
	}

	var next = function(forward, callback) {
		return function(request, response, next){
			var params = getParams(request);
			var session = request.session;
			var onward = callback(request, response, next, session, params);
			if( typeof(onward) === 'string' ){
				forward = onward;
			}
			response.render(forward, { request : request, response : response, session : session, params : params });
		};
	}

	exports.webUtil = {
		next	: next
	}
})(jstlWcUtil);